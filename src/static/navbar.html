<!-- universal-header.html - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π header –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–° –û–¢–õ–ê–î–ö–û–ô) -->
<style>
  .user-dropdown {
    position: relative;
  }
  .user-dropdown-menu {
    display: none;
    position: absolute;
    right: 0;
    top: 100%;
    margin-top: 0.5rem;
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    min-width: 200px;
    z-index: 50;
  }
  .user-dropdown:hover .user-dropdown-menu {
    display: block;
  }
  @keyframes pulse-dot {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  .pulse-dot {
    animation: pulse-dot 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
</style>

<header class="bg-white shadow-md border-b border-gray-200">
  <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between">
      <!-- Logo & Title -->
      <a href="/" class="flex items-center gap-4 hover:opacity-80 transition">
        <!-- GREEN-API Logo -->
        <svg width="50" height="50" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <rect width="100" height="100" rx="12" fill="#3B9702"/>
          <text x="50" y="70" font-family="Arial, sans-serif" font-size="60" font-weight="bold" fill="white" text-anchor="middle">G</text>
        </svg>
        <div>
          <h1 class="text-2xl font-bold text-gray-900">Webhook Viewer</h1>
          <p class="text-xs text-green-600 font-semibold">GREEN-API QA TEAM</p>
        </div>
      </a>

      <!-- Right Side: Navigation & User Menu -->
      <div class="flex items-center gap-4">
        <!-- Navigation Links (Desktop) -->
        <nav class="hidden md:flex items-center gap-4" id="header-nav-links">
          <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
        </nav>

        <!-- Connection Status (—Ç–æ–ª—å–∫–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π) -->
        <div id="header-connection-status" class="hidden">
          <!-- –ë—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ webhooks -->
        </div>

        <!-- User Dropdown -->
        <div id="header-user-menu">
          <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
        </div>

        <!-- GREEN-API Link -->
        <a href="https://green-api.com" target="_blank"
           class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition shadow-sm">
          GREEN-API ‚Üí
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  // Universal Header JavaScript (–° –û–¢–õ–ê–î–ö–û–ô)
  console.log('üîß Header script loading...');

  (function() {
    const apiBase = window.location.origin;
    const token = localStorage.getItem('jwt_token');
    const userStr = localStorage.getItem('user');

    console.log('üìä Header data:', {
      hasToken: !!token,
      userStr: userStr,
      currentPage: window.location.pathname
    });

    let user = null;
    try {
      user = userStr ? JSON.parse(userStr) : null;
      console.log('üë§ Parsed user:', user);
    } catch (e) {
      console.error('‚ùå Failed to parse user:', e);
    }

    const currentPage = window.location.pathname;

    function updateHeader() {
      console.log('üîÑ Updating header...');

      const navLinks = document.getElementById('header-nav-links');
      const userMenu = document.getElementById('header-user-menu');

      if (!navLinks) {
        console.error('‚ùå header-nav-links not found!');
        return;
      }

      if (!userMenu) {
        console.error('‚ùå header-user-menu not found!');
        return;
      }

      if (token && user) {
        console.log('‚úÖ User logged in:', user.username);

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–û–ù–ù–´–ï –°–°–´–õ–ö–ò ==========
        const links = [
          { href: '/', text: 'üè† –ì–ª–∞–≤–Ω–∞—è', active: currentPage === '/' || currentPage === '/index.html' },
          { href: '/tester.html', text: 'üß™ API Tester', active: currentPage === '/tester.html' },
          { href: '/docs', text: 'üìñ Docs', active: currentPage === '/docs' }
        ];

        if (user.role === 'admin') {
          links.push({ href: '/admin.html', text: 'üëë Admin', active: currentPage === '/admin.html' });
        }

        navLinks.innerHTML = links.map(link => `
          <a href="${link.href}"
             class="text-gray-700 hover:text-green-600 font-medium transition ${link.active ? 'text-green-600 font-semibold' : ''}">
            ${link.text}
          </a>
        `).join('');

        // ========== USER DROPDOWN MENU ==========
        userMenu.innerHTML = `
          <div class="user-dropdown">
            <button class="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition">
              <span class="font-medium text-gray-800">${user.username}</span>
              <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="user-dropdown-menu">
              <div class="py-2">
                <div class="px-4 py-2 text-sm text-gray-500 border-b border-gray-200">
                  <div class="font-semibold text-gray-800">${user.username}</div>
                  <div class="text-xs">${user.role === 'admin' ? 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
                </div>
                <a href="/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition">
                  üè† –ì–ª–∞–≤–Ω–∞—è
                </a>
                <a href="/tester.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition">
                  üß™ API Tester
                </a>
                <a href="/docs" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition">
                  üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
                </a>
                ${user.role === 'admin' ? `
                  <a href="/admin.html" class="block px-4 py-2 text-sm text-purple-600 hover:bg-purple-50 transition">
                    üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                  </a>
                ` : ''}
                <div class="border-t border-gray-200 mt-2 pt-2">
                  <button onclick="headerLogout()" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition">
                    üö™ –í—ã–π—Ç–∏
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;

        console.log('‚úÖ Nav links added:', links.length);
        console.log('‚úÖ User menu added');

        // Connection Status (—Ç–æ–ª—å–∫–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
        if (currentPage === '/' || currentPage === '/index.html') {
          const connStatus = document.getElementById('header-connection-status');
          if (connStatus) {
            connStatus.classList.remove('hidden');
            connStatus.innerHTML = `
              <div class="flex items-center gap-2 px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm">
                <span class="w-2 h-2 bg-green-500 rounded-full pulse-dot"></span>
                <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
              </div>
            `;
            console.log('‚úÖ Connection status added');
          }
        }

      } else {
        console.log('‚ö†Ô∏è User NOT logged in');

        // ========== –ù–ï –ó–ê–õ–û–ì–ò–ù–ï–ù ==========
        const links = [
          { href: '/login.html', text: 'üîê –í—Ö–æ–¥', active: currentPage === '/login.html' },
          { href: '/register.html', text: 'üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', active: currentPage === '/register.html' }
        ];

        navLinks.innerHTML = links.map(link => `
          <a href="${link.href}"
             class="text-gray-700 hover:text-green-600 font-medium transition ${link.active ? 'text-green-600 font-semibold' : ''}">
            ${link.text}
          </a>
        `).join('');

        userMenu.innerHTML = `
          <a href="/login.html"
             class="px-4 py-2 bg-gray-900 hover:bg-gray-800 text-white rounded-lg font-medium transition">
            –í–æ–π—Ç–∏
          </a>
        `;

        console.log('‚úÖ Guest links added');
      }

      console.log('‚úÖ Header update complete!');
    }

    // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
    window.headerLogout = function() {
      console.log('üëã Logging out...');
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
        localStorage.clear();
        window.location.href = '/login.html';
      }
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º header
    updateHeader();

    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è localStorage (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ)
    window.addEventListener('storage', () => {
      console.log('üîÑ Storage changed, updating header...');
      updateHeader();
    });

    console.log('‚úÖ Header script loaded!');
  })();
</script>